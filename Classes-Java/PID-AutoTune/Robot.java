package frc.robot;

import edu.wpi.first.wpilibj.TimedRobot;

import pidtuner.PID_ATune.CONTROL_TYPE;
import pidtuner.PID_ATune.DIRECTION;
import pidtuner.PID_ATune;

import stripchart.StripChart;

import com.ctre.phoenix.motorcontrol.ControlMode;
import com.ctre.phoenix.motorcontrol.can.TalonSRX;
import com.ctre.phoenix.motorcontrol.FeedbackDevice;

public class Robot extends TimedRobot {
  private static int sampleTime = 4; // milliseconds loop sample time period
  private static TalonSRX Motor;
  private PID_ATune tuner;
  private long millisStart;
  // control (output) signal limits
  double controllerMin = -1., controllerMax = 1.;
  double output= 0.2; // %vBus for Talon
  double oStep = 0.1; // + and - step size for the output perturbation (relay)
  double setpoint; // below we'll find out the rpm we get for the output signal specified above
  double RPMconversion = 1.116071428571429; // convert raw encoder to gear box shaft RPM  * (10.* 60.)/(19.2 * 7. * 4.) = 1.116071428571429
  // better yet leave everything in native units so no conversion required; remove conversion or set it to 1.
  boolean tuning = true;
  StripChart myChart;

  Robot()
  {
    super(.005); // set the robot loop time
  }

  @Override
  public void robotInit()
  {
   Motor = new TalonSRX(0);
   Motor.configSelectedFeedbackSensor(FeedbackDevice.QuadEncoder, 0, 30);
   Motor.setStatusFramePeriod(2, 5, 30);
  }

  @Override
  public void teleopInit() {

    // Tuned with %VBus/RPM of gearbox shaft output

    Motor.set(ControlMode.PercentOutput, output);
      try {Thread.sleep(5000);} // let motor speed stabilize
          catch (InterruptedException e) {e.printStackTrace();}

    //get the (average) speed (setpoint or input) at this output (power level)

    setpoint = 0;
    for(int idx =1; idx <=20; idx++)
    {
        double speed = Motor.getSelectedSensorVelocity();
        setpoint += speed;
 
        //System.out.println("speed " + speed);
        try {Thread.sleep(100);} // let motor speed stabilize
          catch (InterruptedException e) {e.printStackTrace();}

    }

    setpoint /= 20.; // average of the raw sensor speed
    setpoint = setpoint * RPMconversion;
    System.out.println(" power level " + output + ", RPM " + setpoint + " power level step +- " + oStep);

    tuner = new PID_ATune( setpoint, output, oStep, DIRECTION.DIRECT, CONTROL_TYPE.PID_CONTROL, sampleTime);
    
    //   S E T U P   S T R I P C H A R T   T O   D I S P L A Y   A C T I O N S
    // center of left process variable graph; minimum value of right controller graph; maximum value of right controller graph
    myChart = new StripChart( setpoint,	output-oStep,	output+oStep);

    millisStart = System.currentTimeMillis(); // start time now will be relative 0;
  }

  @Override
  public void teleopPeriodic()
  {
    if(!tuning) return;

      double speed = Motor.getSelectedSensorVelocity() * RPMconversion; // get the speed of the current output; raw * conversion factor = rpm
      int loopStartTime = (int)(System.currentTimeMillis() - millisStart);
      int rc = tuner.Runtime(speed, loopStartTime);
      // 0 still looking for peaks
      // 1 stop - didn't find peaks; give up; or okay - peaks found and tuned
      // 2 waiting for time; no processing
      // 3 tuned but keep going
      //System.out.println("tuner ret " + rc);

      switch (rc) // 0 took a time step; 1 done tuning; 2 called faster than sample rate; 3 intermediate parameters available
      {
      case 1:  // tuning just completed; mark that event, print the peak, and move on
        tuning = false;
      case 3:  // time step okay, print the peak, and process time step
        System.out.format("  peaks %d-%d, Ku=%.5f, Pu=%.5f, Kp=%.5f, Ki=%.5f, Kd=%.5f %%VBus/RPM s\n", 
          (int)(1000.*tuner.GetPeak_1()), (int)(1000.*tuner.GetPeak_2()), tuner.GetKu(), tuner.GetPu(), tuner.GetKp(), tuner.GetKi(), tuner.GetKd());
// Ku ultimate gain; Pu ultimate period
//////////////////////////////////////////////////////////////////////////////////
//            START Conversion to Talon units
//
// Tuned with %VBus/RPM
// Talon SRX PID controller internally uses throttle units/encoder edges per 100ms
// Essentially undo the units conversion previously done
//
//           1023 throttle units per %VBus / (4 edges per quadrature encoder pulse * 7 encoder pulses per motor rev
//           * 19.2 motor revs per gear box output shaft rev /
//           (60 seconds per minute * 10 100ms per seconds))
//				double KuUnits = 1023. / (( 4. * 7. * 19.2 ) / ( 60. * 10. ));
        double KuUnits = 1023. * RPMconversion;
// Tuned with Seconds;  Talon SRX PID controller internally uses milliseconds for intgeration and differentiation
//           1000 milliseconds per seconds
				double PuUnits = 1000.;

				double kP = tuner.GetKp() * KuUnits;
				double kI = tuner.GetKi() * KuUnits/PuUnits;
				double kD = tuner.GetKd() * KuUnits*PuUnits;
				System.out.println("Talon PID Kp= " + kP + " Ki=" + kI + " Kd=" + kD + " throttle units/edges/motor shaft rev/100ms ms\n");
//
//            END Conversion to CAN Talon units
/////////////////////////////////////////////////////////////////////////////////

      case 0:  // time step okay, process time step
        break;
      case 2:  // too fast, skipping this step
        return;
      default:
        System.err.println("\n\nUnknown return from Runtime()\n\n");
      }

      output = tuner.getOutput(); // get the new output
      Motor.set(ControlMode.PercentOutput, output); // set a new speed using the new output

      // time in milliseconds;	process variable - input to controller;	output from controller
      System.out.print("\n" + myChart.PrintStripChart( loopStartTime,	speed, output ) );
      //System.out.println("speed " + speed + ", output " + output);

      if(!tuning)
      {
        Motor.set(ControlMode.PercentOutput, 0.); // stop
      }
  }
}

       // .2 %Vbus is about 60.268 rpm is about 54 raw units  1.116071428571429
        // getVelocity is raw encoder per 100ms
        // *10 100ms/s
        // *60 s/min
        // /19.2 motor revs/gear box output rev
        // /7 encoder pulses/ motor rev
        // /4 edges /pulse
    //    Encoder:
//There is an encoder mounted to the back side of this motor.
//  It is a 7 pulse per revolution (ppr) hall effect encoder.
//   Since the motor's gearbox has a 19.2:1 reduction,
//    the NeverRest Orbital 20 output shaft provides 134.4 ppr, or 537.6 counts per revolution within the software environment.
        // neverest 20:1



/*
power level 0.2, RPM 61.43973214285717 power level step +- 0.1
[Time msecs] [PV chart min, value, max] ~~~~~~~~~ [Controller chart, min, value, max]
3 61.384 61.384 61.496 | . . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300	teleopPeriodic(): 0.010746s
25 61.384 61.384 61.496 | . . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
47 58.147 64.732 64.732 . . . . . + . . . . | ~ | . . . . + . . . . . 0.100 0.100 0.300
61 58.147 64.732 64.732 . . . . . + . . . . | ~ | . . . . + . . . . . 0.100 0.100 0.300
73 46.987 75.893 75.893 . . . . . + . . . . | ~ | . . . . + . . . . . 0.100 0.100 0.300
87 46.987 75.893 75.893 . . . . . + . . . . | ~ | . . . . + . . . . . 0.100 0.100 0.300
100 46.987 71.429 75.893 . . . . . + . . .|. . ~ | . . . . + . . . . . 0.100 0.100 0.300
111 46.987 71.429 75.893 . . . . . + . . .|. . ~ | . . . . + . . . . . 0.100 0.100 0.300
125 46.987 66.964 75.893 . . . . . + . | . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
138 46.987 66.964 75.893 . . . . . + . | . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
148 46.987 55.804 75.893 . . . | . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
161 46.987 55.804 75.893 . . . | . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
166 46.987 55.804 75.893 . . . | . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
172 35.714 35.714 87.165 | . . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
180 35.714 35.714 87.165 | . . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
186 35.714 35.714 87.165 | . . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
192 35.714 42.411 87.165 . | . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
201 35.714 42.411 87.165 . | . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
207 35.714 42.411 87.165 . | . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
213 35.714 53.571 87.165 . . . .|. + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
220 35.714 53.571 87.165 . . . .|. + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
226 35.714 53.571 87.165 . . . .|. + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
231 35.714 53.571 87.165 . . . .|. + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
240 35.714 66.964 87.165 . . . . . + | . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
252 35.714 66.964 87.165 . . . . . + | . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
266 35.714 79.241 87.165 . . . . . + . . .|. . ~ | . . . . + . . . . . 0.100 0.100 0.300
279 35.714 79.241 87.165 . . . . . + . . .|. . ~ | . . . . + . . . . . 0.100 0.100 0.300
291 35.714 75.893 87.165 . . . . . + . . | . . ~ | . . . . + . . . . . 0.100 0.100 0.300
311 35.714 75.893 87.165 . . . . . + . . | . . ~ | . . . . + . . . . . 0.100 0.100 0.300
336 35.714 51.339 87.165 . . . | . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
366 35.714 39.063 87.165 .|. . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
396 35.714 52.455 87.165 . . . .|. + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
421 35.714 64.732 87.165 . . . . . +|. . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
444 35.714 78.125 87.165 . . . . . + . . .|. . ~ | . . . . + . . . . . 0.100 0.100 0.300
465 35.714 83.705 87.165 . . . . . + . . . .|. ~ | . . . . + . . . . . 0.100 0.100 0.300
485 35.714 75.893 87.165 . . . . . + . . | . . ~ | . . . . + . . . . . 0.100 0.100 0.300
498 35.714 75.893 87.165 . . . . . + . . | . . ~ | . . . . + . . . . . 0.100 0.100 0.300
504 35.714 75.893 87.165 . . . . . + . . | . . ~ | . . . . + . . . . . 0.100 0.100 0.300 peaks 465-266, Ku=0.00531, Pu=0.19900, Kp=0.00318, Ki=0.03200, Kd=0.00008 %VBus/RPM s
Talon PID Kp= 3.6349508491090363 Ki=0.03653216933777926 Kd=90.41940237158728 throttle units/edges/motor shaft rev/100ms ms
510 35.714 51.339 87.165 . . . | . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
532 35.714 37.946 87.165 .|. . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
537 35.714 37.946 87.165 .|. . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
542 35.714 37.946 87.165 .|. . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
546 35.714 37.946 87.165 .|. . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
550 35.714 37.946 87.165 .|. . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
554 35.714 37.946 87.165 .|. . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
558 35.714 37.946 87.165 .|. . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
566 35.714 37.946 87.165 .|. . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
570 35.714 37.946 87.165 .|. . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
578 35.714 47.991 87.165 . . .|. . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
582 35.714 47.991 87.165 . . .|. . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
586 35.714 47.991 87.165 . . .|. . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
590 35.714 47.991 87.165 . . .|. . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
599 35.714 59.152 87.165 . . . . .|+ . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
608 35.714 59.152 87.165 . . . . .|+ . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
612 35.714 59.152 87.165 . . . . .|+ . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
618 35.714 59.152 87.165 . . . . .|+ . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
624 35.714 72.545 87.165 . . . . . + . | . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
639 35.714 72.545 87.165 . . . . . + . | . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
643 35.714 72.545 87.165 . . . . . + . | . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
648 35.714 85.938 87.165 . . . . . + . . . . | ~ | . . . . + . . . . . 0.100 0.100 0.300
652 35.714 85.938 87.165 . . . . . + . . . . | ~ | . . . . + . . . . . 0.100 0.100 0.300
657 35.714 85.938 87.165 . . . . . + . . . . | ~ | . . . . + . . . . . 0.100 0.100 0.300
661 35.714 85.938 87.165 . . . . . + . . . . | ~ | . . . . + . . . . . 0.100 0.100 0.300
665 35.714 85.938 87.165 . . . . . + . . . . | ~ | . . . . + . . . . . 0.100 0.100 0.300
669 35.714 85.938 87.165 . . . . . + . . . . | ~ | . . . . + . . . . . 0.100 0.100 0.300
673 35.714 85.938 87.165 . . . . . + . . . . | ~ | . . . . + . . . . . 0.100 0.100 0.300
681 35.714 85.938 87.165 . . . . . + . . . . | ~ | . . . . + . . . . . 0.100 0.100 0.300
685 35.714 85.938 87.165 . . . . . + . . . . | ~ | . . . . + . . . . . 0.100 0.100 0.300 peaks 648-465, Ku=0.00507, Pu=0.18300, Kp=0.00304, Ki=0.03325, Kd=0.00007 %VBus/RPM s
Talon PID Kp= 3.4733974780375236 Ki=0.037960628175273486 Kd=79.45396731010835 throttle units/edges/motor shaft rev/100ms ms
693 35.714 63.616 87.165 . . . . . +|. . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
710 35.714 63.616 87.165 . . . . . +|. . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
716 35.714 51.339 87.165 . . . | . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
720 35.714 51.339 87.165 . . . | . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
724 35.714 51.339 87.165 . . . | . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
728 35.714 51.339 87.165 . . . | . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
732 35.714 51.339 87.165 . . . | . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
737 35.714 40.179 87.165 . | . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
742 35.714 40.179 87.165 . | . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
746 35.714 40.179 87.165 . | . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
759 35.714 43.527 87.165 . .|. . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
773 35.714 43.527 87.165 . .|. . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
783 35.714 53.571 87.165 . . . .|. + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
790 35.714 53.571 87.165 . . . .|. + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
796 35.714 53.571 87.165 . . . .|. + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
800 35.714 53.571 87.165 . . . .|. + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
805 35.714 66.964 87.165 . . . . . + | . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
809 35.714 66.964 87.165 . . . . . + | . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
813 35.714 66.964 87.165 . . . . . + | . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
818 35.714 66.964 87.165 . . . . . + | . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
822 35.714 66.964 87.165 . . . . . + | . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
826 35.714 79.241 87.165 . . . . . + . . .|. . ~ | . . . . + . . . . . 0.100 0.100 0.300
830 35.714 79.241 87.165 . . . . . + . . .|. . ~ | . . . . + . . . . . 0.100 0.100 0.300
836 35.714 79.241 87.165 . . . . . + . . .|. . ~ | . . . . + . . . . . 0.100 0.100 0.300
840 35.714 79.241 87.165 . . . . . + . . .|. . ~ | . . . . + . . . . . 0.100 0.100 0.300
844 35.714 79.241 87.165 . . . . . + . . .|. . ~ | . . . . + . . . . . 0.100 0.100 0.300
848 35.714 83.705 87.165 . . . . . + . . . .|. ~ | . . . . + . . . . . 0.100 0.100 0.300
852 35.714 83.705 87.165 . . . . . + . . . .|. ~ | . . . . + . . . . . 0.100 0.100 0.300
856 35.714 83.705 87.165 . . . . . + . . . .|. ~ | . . . . + . . . . . 0.100 0.100 0.300
863 35.714 83.705 87.165 . . . . . + . . . .|. ~ | . . . . + . . . . . 0.100 0.100 0.300
867 35.714 83.705 87.165 . . . . . + . . . .|. ~ | . . . . + . . . . . 0.100 0.100 0.300 peaks 848-648, Ku=0.00507, Pu=0.20000, Kp=0.00304, Ki=0.03042, Kd=0.00008 %VBus/RPM s
Talon PID Kp= 3.4733974780375236 Ki=0.03473397478037524 Kd=86.8349369509381 throttle units/edges/motor shaft rev/100ms ms
871 35.714 63.616 87.165 . . . . . +|. . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
883 35.714 63.616 87.165 . . . . . +|. . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
887 35.714 63.616 87.165 . . . . . +|. . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
897 35.714 50.223 87.165 . . . | . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
911 35.714 50.223 87.165 . . . | . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
918 35.714 36.830 87.165 | . . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
924 35.714 36.830 87.165 | . . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
929 35.714 36.830 87.165 | . . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
933 35.714 36.830 87.165 | . . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
938 35.714 36.830 87.165 | . . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
943 35.714 36.830 87.165 | . . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
947 35.714 36.830 87.165 | . . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
951 35.714 36.830 87.165 | . . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
959 35.714 46.875 87.165 . . | . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
963 35.714 46.875 87.165 . . | . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
967 35.714 46.875 87.165 . . | . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
971 35.714 46.875 87.165 . . | . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
976 35.714 46.875 87.165 . . | . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
980 35.714 59.152 87.165 . . . . .|+ . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
984 35.714 59.152 87.165 . . . . .|+ . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
988 35.714 59.152 87.165 . . . . .|+ . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
992 35.714 59.152 87.165 . . . . .|+ . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
997 35.714 59.152 87.165 . . . . .|+ . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1002 35.714 73.661 87.165 . . . . . + . .|. . . ~ | . . . . + . . . . . 0.100 0.100 0.300
1006 35.714 73.661 87.165 . . . . . + . .|. . . ~ | . . . . + . . . . . 0.100 0.100 0.300
1010 35.714 73.661 87.165 . . . . . + . .|. . . ~ | . . . . + . . . . . 0.100 0.100 0.300
1014 35.714 73.661 87.165 . . . . . + . .|. . . ~ | . . . . + . . . . . 0.100 0.100 0.300
1019 35.714 73.661 87.165 . . . . . + . .|. . . ~ | . . . . + . . . . . 0.100 0.100 0.300
1023 35.714 85.938 87.165 . . . . . + . . . . | ~ | . . . . + . . . . . 0.100 0.100 0.300
1027 35.714 85.938 87.165 . . . . . + . . . . | ~ | . . . . + . . . . . 0.100 0.100 0.300
1031 35.714 85.938 87.165 . . . . . + . . . . | ~ | . . . . + . . . . . 0.100 0.100 0.300Watchdog not fed within 0.005000s
1035 35.714 85.938 87.165 . . . . . + . . . . | ~ | . . . . + . . . . . 0.100 0.100 0.300	teleopPeriodic(): 0.011518s
peaks 1022-848, Ku=0.00507, Pu=0.17500, Kp=0.00304, Ki=0.03477, Kd=0.00007 %VBus/RPM s
Talon PID Kp= 3.4733974780375236 Ki=0.0396959711775717 Kd=75.98056983207083 throttle units/edges/motor shaft rev/100ms ms
1053 35.714 75.893 87.165 . . . . . + . . | . . ~ | . . . . + . . . . . 0.100 0.100 0.300
1064 35.714 75.893 87.165 . . . . . + . . | . . ~ | . . . . + . . . . . 0.100 0.100 0.300
1068 35.714 75.893 87.165 . . . . . + . . | . . ~ | . . . . + . . . . . 0.100 0.100 0.300
1072 35.714 75.893 87.165 . . . . . + . . | . . ~ | . . . . + . . . . . 0.100 0.100 0.300
1076 35.714 64.732 87.165 . . . . . +|. . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
1080 35.714 64.732 87.165 . . . . . +|. . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
1084 35.714 64.732 87.165 . . . . . +|. . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
1088 35.714 64.732 87.165 . . . . . +|. . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
1092 35.714 64.732 87.165 . . . . . +|. . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
1097 35.714 50.223 87.165 . . . | . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1101 35.714 50.223 87.165 . . . | . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1113 35.714 50.223 87.165 . . . | . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1122 35.714 40.179 87.165 . | . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1126 35.714 40.179 87.165 . | . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1130 35.714 40.179 87.165 . | . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1134 35.714 40.179 87.165 . | . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1138 35.714 40.179 87.165 . | . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1142 35.714 42.411 87.165 . | . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1146 35.714 42.411 87.165 . | . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1150 35.714 42.411 87.165 . | . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1154 35.714 42.411 87.165 . | . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1158 35.714 42.411 87.165 . | . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1162 35.714 54.688 87.165 . . . .|. + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1166 35.714 54.688 87.165 . . . .|. + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1170 35.714 54.688 87.165 . . . .|. + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1175 35.714 54.688 87.165 . . . .|. + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1179 35.714 54.688 87.165 . . . .|. + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1183 35.714 66.964 87.165 . . . . . + | . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
1200 35.714 66.964 87.165 . . . . . + | . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
1206 35.714 80.357 87.165 . . . . . + . . .|. . ~ | . . . . + . . . . . 0.100 0.100 0.300
1213 35.714 80.357 87.165 . . . . . + . . .|. . ~ | . . . . + . . . . . 0.100 0.100 0.300
1221 35.714 80.357 87.165 . . . . . + . . .|. . ~ | . . . . + . . . . . 0.100 0.100 0.300
1228 35.714 84.821 87.165 . . . . . + . . . .|. ~ | . . . . + . . . . . 0.100 0.100 0.300
1232 35.714 84.821 87.165 . . . . . + . . . .|. ~ | . . . . + . . . . . 0.100 0.100 0.300
1240 35.714 84.821 87.165 . . . . . + . . . .|. ~ | . . . . + . . . . . 0.100 0.100 0.300 peaks 1228-1022, Ku=0.00507, Pu=0.20500, Kp=0.00304, Ki=0.02968, Kd=0.00008 %VBus/RPM s
Talon PID Kp= 3.4733974780375236 Ki=0.033886804663780724 Kd=89.00581037471154 throttle units/edges/motor shaft rev/100ms ms
1249 35.714 77.009 87.165 . . . . . + . . | . . ~ | . . . . + . . . . . 0.100 0.100 0.300
1273 35.714 51.339 87.165 . . . | . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1277 35.714 51.339 87.165 . . . | . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1282 35.714 51.339 87.165 . . . | . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1286 35.714 51.339 87.165 . . . | . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1290 35.714 51.339 87.165 . . . | . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1295 35.714 40.179 87.165 . | . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1299 35.714 40.179 87.165 . | . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1303 35.714 40.179 87.165 . | . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1307 35.714 40.179 87.165 . | . . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1316 35.714 43.527 87.165 . .|. . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1320 35.714 43.527 87.165 . .|. . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1324 35.714 43.527 87.165 . .|. . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1328 35.714 43.527 87.165 . .|. . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1332 35.714 43.527 87.165 . .|. . . + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1337 35.714 53.571 87.165 . . . .|. + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1341 35.714 53.571 87.165 . . . .|. + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1345 35.714 53.571 87.165 . . . .|. + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1349 35.714 53.571 87.165 . . . .|. + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1353 35.714 53.571 87.165 . . . .|. + . . . . . ~ . . . . . + . . . . | 0.100 0.300 0.300
1357 35.714 65.848 87.165 . . . . . + | . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
1361 35.714 65.848 87.165 . . . . . + | . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
1369 35.714 65.848 87.165 . . . . . + | . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
1373 35.714 65.848 87.165 . . . . . + | . . . . ~ | . . . . + . . . . . 0.100 0.100 0.300
1378 35.714 79.241 87.165 . . . . . + . . .|. . ~ | . . . . + . . . . . 0.100 0.100 0.300
1382 35.714 79.241 87.165 . . . . . + . . .|. . ~ | . . . . + . . . . . 0.100 0.100 0.300
1386 35.714 79.241 87.165 . . . . . + . . .|. . ~ | . . . . + . . . . . 0.100 0.100 0.300
1390 35.714 79.241 87.165 . . . . . + . . .|. . ~ | . . . . + . . . . . 0.100 0.100 0.300
1400 35.714 84.821 87.165 . . . . . + . . . .|. ~ | . . . . + . . . . . 0.100 0.100 0.300
1404 35.714 84.821 87.165 . . . . . + . . . .|. ~ | . . . . + . . . . . 0.100 0.100 0.300
1408 35.714 84.821 87.165 . . . . . + . . . .|. ~ | . . . . + . . . . . 0.100 0.100 0.300
1412 35.714 84.821 87.165 . . . . . + . . . .|. ~ | . . . . + . . . . . 0.100 0.100 0.300
1416 35.714 84.821 87.165 . . . . . + . . . .|. ~ | . . . . + . . . . . 0.100 0.100 0.300 peaks 1400-1228, Ku=0.00507, Pu=0.17200, Kp=0.00304, Ki=0.03537, Kd=0.00007 %VBus/RPM s
Talon PID Kp= 3.4733974780375236 Ki=0.040388342767878185 Kd=74.67804577780676 throttle units/edges/motor shaft rev/100ms ms
1420 35.714 77.009 87.165 . . . . . + . . | . . ~ | . . . . + . . . . . 0.100 0.100 0.300D
*/